---
title: "BASH per Bioinformatica"
format: html
---

# Bash

# Apriamo il terminale

## Capiamo dove ci troviamo nel terminale

```bash
pwd
```
## Guardiamo che files sono presenti nella directory in cui ci troviamo:

```bash
ls
ls -ltrh
man list
```

## Entriamo nella cartella esercizi_fastq e listiamo i file presenti

```bash
cd esercizi_fastq
ls -ltrh
```
## Creiamo una nuova cartella

```bash
mkdir directory_prova_fastq
```
## Copiamo un file fastq

```bash
cp S1_10_L001_R1_001.fastq.gz primo_file.fastq
```

## Rinominiamo questo file

```bash
mv primo_file.fastq file_prova_fastq
```
## Spostiamolo nella cartella prova_fastq che abbiamo creato

```bash
mv file_prova_fastq /directory_prova_fastq
```
## Torniamo alla directory precedente

```bash
cd ..
ls *.gz
```

## Visualizziamo le prime 8 righe

```bash
zcat S1_10_L001_R1_001.fastq.gz | head -n 8
```
Oppure possiamo usare:

```bash
gunzip -c S1_10_L001_R1_001.fastq.gz | head -n 8
```
## Per scorrere il file

```bash
zcat S1_10_L001_R1_001.fastq.gz | less -S
```

## Contiamo le righe

```bash
zcat S1_10_L001_R1_001.fastq.gz | wc -l
```

## Contiamo il numero di reads

```bash
zcat test_S1_R1.fastq.gz | grep -c "^@"
```
Oppure possiamo usare:

```bash
echo $(( $(zcat S1_10_L001_R1_001.fastq.gz | wc -l) / 4 ))
```

## Cerchiamo una sequenza

```bash
zcat S1_10_L001_R1_001.fastq.gz | grep -c "ACGTACG"
```

## Contiamo la lunghezza della prima read:

```bash
zcat S1_10_L001_R1_001.fastq.gz | sed -n '2p' | awk '{print length}'
```

Oppure:

```bash
seq=$(zcat S1_10_L001_R1_001.fastq.gz | sed -n '2p')
echo ${#seq}
```

## Calcoliamo la lunghezza di ogni read

```bash
zcat S1_10_L001_R1_001.fastq.gz | awk 'NR%4==2 {print length}'
```

## Calcoliamo la lunghezza media

```bash
zcat S1_10_L001_R1_001.fastq.gz  | awk 'NR%4==2 { total+=length; n++ } END { print total/n }'
```

## Rinominiamo tutti i files

```bash
for f in *.fastq.gz; do
    sample=$(echo "$f" | cut -d'_' -f1)
    read=$(echo "$f" | grep -o "R[12]")
    new="test_${sample}_${read}.fastq.gz"
    mv "$f" "$new"
done
```

## Aggiungiamo un prefisso agli header

```bash
zcat S1_R1.fastq.gz  | awk 'NR%4==1{print "@S1_" substr($0,2)} NR%4!=1{print}'  | gzip > S1_R1_renamed.fastq.gz
```

## Reindirizziamo  l'output

```bash
zcat S1_R1.fastq.gz | head -n 20 > subset_S1_R1.fastq
```

---

## Paths, files and directories
Open linux or mac terminal

```bash
pwd #print working directory
cd #change directory (relative or absolute path)
cd .. # bring you back one directory up
cd ~ #cd home
ls #print list of elements in directory
ls -lh # print sizes in human readable format
man list # (or any command, gives the manual for that command)
history #display last commands
ls *.fasta #list all fasta files
mkdir newfoldername #make new directory
```
---

## Edit files
`nano nomefile`  #create new empty file

- Ctrl+S to save  
- Ctrl+X to exit  
- Ctrl+W to search  

```bash
cp filename pathwheretocopy
mv filename pathwheretocopy
mv filename new_filename
less filename
cat filename
head filename
tail filename
head -n5 filename
wc filename
wc -l filename
rm file
rm *
cp -r foldername
mv foldername pathwheretomove
rm -r foldername
```

> **TIP:** Be VERY careful with `rm`: once removed, files cannot be restored.  
> Remember: Bash is case sensitive.

---

## Merge and sort files

```bash
cat file1 file2 file3 …
cat file1 file2 file3 > merged_file
sort file
sort -h file
sort -k1,1 -k2,2n file
sort -k1,1 -k2,2nr file
paste file1 file2
```

---

## Grep

```bash
grep "word" file
grep -w "word" file
grep -v "word" file
grep -i "word" file
grep -c "word" file
grep -A10 "word" file
grep -B10 "word" file
grep -C10 "word" file
grep "Locus10[12]" file
```

### Special characters

- `^` beginning of line → `grep "^>" file`
- `$` end of line → `grep ">$" file`

> **Regular expressions** match text patterns.

---

## Awk

```bash
awk '{print $1}' file
awk '{print $0}' file
awk '{print $NF}' file
awk '{print $4"	"$1}' file
awk -F";" '{print $3,$4}'
awk '$1==$2 {print}'
awk '$1 ~ /chr1/ && $3-$2>10 {print}'
awk '{if ($1~">") print $0; else print length}' fasta_file
```

---

## Sed

```bash
sed 's/Locus/Transcript/' file
sed 's/Locus/Transcript/g' file
sed -i 's/Locus/Transcript/g' file
sed '/Locus/d' file
```

---

## Pipe `|`

The pipe sends the output of one program as input to the next.

```bash
grep "word" file1 | sed 's/ /	/g' | program1 > file2
```

---

## Variables

```bash
var1="ciao"
echo $var1
echo "$var1"
echo '$var1'
```

---

## For loop

```bash
for i in *.fasta; do echo $i; done
for i in *.fasta; do mv "$i" "${i}_filtered"; done
for i in *fastq; do sed 's/@/>/' "$i" > "${i}_editname"; done
for i in *fasta; do grep -c ">" "$i"; done > counts
for i in *fasta; do program1 "$i" > "output_$i"; done
for i in */ ; do cd "$i"; cp *.fasta ../; cd ..; done
```

---

# Bash Script

Bash scripts end with `.sh`.

Create a script:

```bash
nano get_reads_from_list.sh
```

Content:

```bash
#!/bin/bash
# Retrieve FASTQ reads from a list of read IDs
# $1 = list of read IDs
# $2 = FASTQ file (.fastq.gz)

list="$1"
fastq="$2"

while read id; do
    zcat "$fastq" | grep -A3 -w "^$id"
done < "$list" > "${list}.fastq"
```

Make executable:

```bash
chmod +x get_reads_from_list.sh
```

Run:

```bash
bash get_reads_from_list.sh list_ids S1_10_L001_R1_001.fastq.gz
cat list_ids.fastq
```

---

# Conda

```bash
conda init bash
conda env list
conda activate myenv
conda list
conda deactivate
conda create --name envname
conda install -c conda-forge package
conda create --name envname -c conda-forge package
```

